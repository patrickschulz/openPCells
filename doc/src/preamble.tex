\documentclass[parskip=half]{scrartcl}

\usepackage{tikz}
\usetikzlibrary{positioning, shapes, patterns, shapes.multipart}
\tikzset{
    state/.style = {draw, align=center, minimum width = 2.1cm, rectangle split, rectangle split parts = 3, thick, minimum height = 5cm},
    tip/.style = {thick, ->, >=stealth}
}
\usepackage{wrapfig}

\usepackage{fontspec}
\usepackage{unicode-math}
\usepackage{microtype}
\setmainfont{Libertinus Serif}
\setsansfont{Libertinus Sans}
\setmathfont{Libertinus Math}

% maths
\usepackage{IEEEtrantools}

% tables
\usepackage{booktabs}

\usepackage{enumitem}

\usepackage{listings}
\lstdefinestyle{shellstyle}{
    breaklines = true,
    breakautoindent = false,
    backgroundcolor = \color{black!10!white},
    basicstyle = \small\ttfamily,
    showstringspaces = false,
    tabsize = 4,
    gobble = 4,
    belowskip=-0.2\baselineskip
}
\lstdefinestyle{luastyle}{
    breaklines = true,
    %breakatwhitespace = true,
    language=[5.3]Lua,
    backgroundcolor = \color{blue!10!white},
    basicstyle = \small\ttfamily,
    keywordstyle = \color{blue},
    commentstyle = \color{red},
    stringstyle = \color{green!70!black},
    showstringspaces = false,
    tabsize = 4,
    gobble = 4,
    emph = {
        layout,
        parameters,
        % rectangle module
        geometry, 
        geometry.rectangle, 
        rectangle, 
        geometry.rectanglebltr, 
        rectanglebltr, 
        geometry.rectanglepoints, 
        rectanglepoints, 
        geometry.path, 
        path, 
        geometry.via, 
        via, 
        geometry.viabltr, 
        viabltr, 
        geometry.contact, 
        contact, 
        geometry.contactbltr, 
        contactbltr, 
        % pcell module
        pcell.create_layout, 
        pcell.create_layout_env, 
        pcell.setup, 
        pcell.process_args, 
        pcell.check_args,
        pcell.add_parameters,
        pcell.get_parameters,
        pcell.push_overwrites,
        pcell.pop_overwrites,
        % point module
        point.create,
        point.xdistance,
        point.ydistance,
        point.combine_12,
        point.combine_21,
        point.combine,
        point.unwrap,
        unwrap,
        point.getx,
        getx,
        point.gety,
        gety,
        add_child,
        object.add_child,
        add_child_array,
        object.add_child_array,
        object.create,
        object.translate,
        object.merge_into,
        get_anchor,
        get_area_anchor,
        move_anchor,
        translate,
        merge_into,
        flipx,
        flipy,
        generics,
        generics.metal,
        generics.via,
        generics.contact,
        generics.other,
        generics.mapped,
        util.xmirror,
        util.make_insert_xy
        curve.arcto,
        curve.cubicto,
        curve.lineto,
        generics.contact,
        generics.implant,
        generics.metal,
        generics.metalexclude,
        generics.metalfill,
        generics.metalport,
        generics.mptmetal,
        generics.mptmetalfill,
        generics.other,
        generics.otherport,
        generics.outline,
        generics.oxide,
        generics.premapped,
        generics.special,
        generics.viacut,
        generics.vthtype,
        geometry.rectanglebltr,
        geometry.rectangleblwh,
        geometry.rectanglepoints,
        geometry.rectanglepath,
        geometry.rectanglearray,
        geometry.slotted_rectangle,
        geometry.rectanglevlines,
        geometry.rectanglevlines_width_space,
        geometry.rectanglevlines_settings,
        geometry.rectanglevlines_width_space_settings,
        geometry.rectanglehlines,
        geometry.rectanglehlines_height_space,
        geometry.rectanglehlines_settings,
        geometry.rectanglehlines_width_space_settings,
        geometry.rectangle_fill_in_boundary,
        geometry.polygon,
        geometry.path,
        geometry.path_manhatten,
        geometry.path_2x,
        geometry.path_2y,
        geometry.path_3x,
        geometry.path_3y,
        geometry.path_cshape,
        geometry.path_ushape,
        geometry.path_points_xy,
        geometry.path_points_yx,
        geometry.viabltr,
        geometry.viabarebltr,
        geometry.viabltr_xcontinuous,
        geometry.viabltr_ycontinuous,
        geometry.viabltr_continuous,
        geometry.viabarebltr_xcontinuous,
        geometry.viabarebltr_ycontinuous,
        geometry.viabarebltr_continuous,
        geometry.contactbltr,
        geometry.contactbarebltr,
        geometry.cross,
        geometry.unequal_ring_pts,
        geometry.unequal_ring,
        geometry.ring,
        geometry.curve,
        geometry.curve,
        set,
        interval,
        even,
        odd,
        positive,
        negative,
        enable,
        evenodddiv2,
        divevenup,
        divevendown,
        dprint,
        layouthelpers.place_bus,
        layouthelpers.place_guardring,
        layouthelpers.place_guardring_with_hole,
        layouthelpers.place_welltap,
        layouthelpers.place_maximum_width_via,
        object.abut_area_anchor_bottom,
        object.abut_area_anchor_left,
        object.abut_area_anchor_right,
        object.abut_area_anchor_top,
        object.abut_bottom,
        object.abut_bottom,
        object.abut_left,
        object.abut_left,
        object.abut_right,
        object.abut_right,
        object.abut_top,
        object.abut_top,
        object.add_anchor,
        object.add_area_anchor_bltr,
        object.add_bus_port,
        object.add_child_array,
        object.add_layer_boundary,
        object.add_layer_boundary_rectangular,
        object.add_port,
        object.add_port_with_anchor,
        object.align_area_anchor_bottom,
        object.align_area_anchor_left,
        object.align_area_anchor_right,
        object.align_area_anchor,
        object.align_area_anchor_top,
        object.align_area_anchor_x,
        object.align_area_anchor_y,
        object.align_bottom,
        object.align_bottom_origin,
        object.align_bottom_origin,
        object.align_left,
        object.alignment_box_include_point,
        object.alignment_box_include_x,
        object.alignment_box_include_y,
        object.align_bottom_origin,
        object.align_right,
        object.align_bottom_origin,
        object.align_top,
        object.clear_alignment_box,
        object.copy,
        object.create_object_handle,
        object.create,
        object.create_pseudo,
        object.exchange,
        object.extend_alignment_box,
        object.extend_alignment_box_x_symmetrical,
        object.extend_alignment_box_xy_symmetrical,
        object.extend_alignment_box_y_symmetrical,
        object.flatten_inline,
        object.flatten_inline,
        object.flatten,
        object.flipx,
        object.flipy,
        object.get_alignment_anchor,
        object.get_all_regular_anchors,
        object.get_anchor,
        object.get_area_anchor_height,
        object.get_area_anchor,
        object.get_area_anchor_width,
        object.get_array_anchor,
        object.get_array_area_anchor,
        object.get_boundary,
        object.get_layer_boundary,
        object.get_ports,
        object.has_boundary,
        object.has_layer_boundary,
        object.inherit_alignment_box,
        object.inherit_anchor_as,
        object.inherit_anchor_as,
        object.inherit_anchor,
        object.inherit_area_anchor_as,
        object.inherit_area_anchor,
        object.inherit_boundary,
        object.merge_into,
        object.merge_into_with_ports,
        object.mirror_at_origin,
        object.mirror_at_xaxis,
        object.mirror_at_yaxis,
        object.move_point,
        object.move_point_x,
        object.move_point_y,
        object.add_child,
        object.move_to,
        object.rasterize_curves,
        object.reset_translation,
        object.rotate_90_left,
        object.rotate_90_right,
        object.set_alignment_box,
        object.set_boundary_rectangular,
        object.set_boundary,
        object.set_empty_layer_boundary,
        object.translate,
        object.translate_x,
        object.translate_y,
        object.width_height_alignmentbox,
        pcell.set_property,
        pcell.add_parameter,
        pcell.add_parameters,
        pcell.get_parameters,
        pcell.push_overwrites,
        pcell.pop_overwrites,
        pcell.check_expression,
        pcell.create_layout,
        pcell.create_layout_env,
        placement.create_floorplan_aspectratio,
        placement.create_floorplan_fixed_rows,
        placement.optimize,
        placement.manual,
        placement.insert_filler_names,
        placement.create_reference_rows,
        placement.digital,
        placement.rowwise,
        placement.rowwise_flat,
        placement.place_at_origins,
        placement.place_within_boundary,
        placement.place_within_boundary_merge,
        placement.place_within_rectangular_boundary,
        point.create,
        point.combine_12,
        point.combine_21,
        point.combine,
        point.copy,
        point.getx,
        point.gety,
        point.translate,
        point.translate_x,
        point.translate_y,
        point.xdistance,
        point.xdistance_abs,
        point.ydistance,
        point.ydistance_abs,
        point.xaverage,
        point.yaverage,
        point.fix,
        point.operator+,
        point.operator-,
        point.operator..,
        point.unwrap,
        routing.legalize,
        routing.route,
        technology.get_dimension,
        technology.has_layer,
        technology.has_multiple_patterning,
        technology.multiple_patterning_number,
        technology.resolve_metal,
        util.xmirror,
        util.ymirror,
        util.xymirror,
        util.filter_forward,
        util.filter_backward,
        util.merge_forwards,
        util.merge_backwards,
        util.reverse,
        util.make_insert_xy,
        util.make_insert_pts,
        util.range,
        util.remove,
        util.remove_index,
        util.remove_inplace,
        util.remove_index_inplace,
        util.fill_all_with,
        util.fill_predicate_with,
        util.fill_even_with,
        util.fill_odd_with,
        util.clone_shallow,
        util.add_options,
        util.ratio_split_even,
        util.rectangle_to_polygon,
        util.any_of,
        util.any_of,
        util.transform_points,
        util.fix_to_grid_higher,
        util.fix_to_grid_lower,
        util.fix_to_grid_abs_higher,
        util.fix_to_grid_abs_lower,
        util.fix_to_grid_abs_lower
    },
    emphstyle = \color{blue!60!green}\bfseries,
    belowskip=-0.2\baselineskip
}
% -------------------------------------------------------------------------------------------------------------
% taken from https://tex.stackexchange.com/questions/48903/how-to-extend-the-lstinputlisting-command
\errorcontextlines=\maxdimen

\newlength{\rawgobble}
\newlength{\gobble}
% Remove a single space
\settowidth{\rawgobble}{\small\ttfamily\ }
\setlength{\rawgobble}{-\rawgobble}

\makeatletter
\lst@Key{widthgobble}{0}{%
    % Reindent a bit by multiplying with 0.9, then multiply by tabsize and number of indentation levels
    %\setlength{\gobble}{0.9\rawgobble}%
    \setlength{\gobble}{#1\rawgobble}%
    %\setlength{\gobble}{\sepstartwo\gobble}%
    \def\lst@xleftmargin{\gobble}%
    \def\lst@framexleftmargin{\gobble}%
}
\makeatother
% -------------------------------------------------------------------------------------------------------------
\newcommand{\shellinline}[1]{\lstinline[style = shellstyle]!#1!}
\lstnewenvironment{shellcode}{\lstset{style = shellstyle}}{}
\newcommand{\luainline}[1]{\lstinline[style = luastyle]!#1!}
\lstnewenvironment{lualisting}{\lstset{style = luastyle}}{}
\newcommand{\luafilelisting}[2][]{\lstinputlisting[style = luastyle, #1]{#2}}

% API documentation commands
\newenvironment{APIfunc}[1]{\par\hspace*{-2em}\luainline{#1}\leftskip=2em\par}{\par}
%\newenvironment{APIparameters}[0]{\begin{description}[font=\mdseries\ttfamily]}{\end{description}}
\newenvironment{APIparameters}[0]{\par\noindent{}Parameters:\scriptsize\par\noindent\begin{tabular}{llp{0.5\linewidth}} Parameter & Type &
Explanation\\\midrule}{\end{tabular}} \def\parameter #1#2#3;{\texttt{#1} & #2 & #3 \\}
\def\parameterdefault #1#2#3#4;{\texttt{#1} (default #2) & #3 & #4 \\}

\usepackage{siunitx}
\usepackage{csquotes}

\frenchspacing

